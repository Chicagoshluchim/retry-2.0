<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Test - Shiur Gimmel Mivtzah</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-section { 
            background: white; 
            margin: 15px 0; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #27ae60; font-weight: bold; }
        .error { color: #e74c3c; font-weight: bold; }
        .info { color: #3498db; }
        h1 { text-align: center; color: #2c3e50; }
        h3 { color: #34495e; margin-top: 0; }
        .result { 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 4px; 
            background: #f8f9fa;
            border-left: 4px solid #dee2e6;
        }
        .result.success { background: #d4edda; border-left-color: #27ae60; }
        .result.error { background: #f8d7da; border-left-color: #e74c3c; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 Modular Architecture Test</h1>
        <p class="info">Testing the refactored Shiur Gimmel Mivtzah application modules...</p>
        
        <div class="test-section">
            <h3>📦 Module Loading Test</h3>
            <div id="loading-results"></div>
        </div>

        <div class="test-section">
            <h3>🏗️ Class Instantiation Test</h3>
            <div id="instantiation-results"></div>
        </div>

        <div class="test-section">
            <h3>🔧 Core Functionality Test</h3>
            <div id="functionality-results"></div>
        </div>

        <div class="test-section">
            <h3>💾 Data Persistence Test</h3>
            <div id="persistence-results"></div>
        </div>
    </div>

    <!-- Load all modules -->
    <script src="core.js"></script>
    <script src="messaging.js"></script>
    <script src="student.js"></script>
    <script src="admin.js"></script>
    <script src="main.js"></script>

    <script>
        function addResult(containerId, message, isSuccess = true) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${isSuccess ? 'success' : 'error'}`;
            div.innerHTML = `${isSuccess ? '✅' : '❌'} ${message}`;
            container.appendChild(div);
        }

        function testModuleLoading() {
            const modules = [
                { name: 'MivtzahCore', class: MivtzahCore },
                { name: 'MivtzahMessaging', class: MivtzahMessaging },
                { name: 'MivtzahStudent', class: MivtzahStudent },
                { name: 'MivtzahAdmin', class: MivtzahAdmin },
                { name: 'MivtzahPlatform', class: MivtzahPlatform }
            ];

            modules.forEach(module => {
                try {
                    if (typeof module.class === 'function') {
                        addResult('loading-results', `${module.name} class loaded successfully`);
                    } else {
                        addResult('loading-results', `${module.name} class not found`, false);
                    }
                } catch (e) {
                    addResult('loading-results', `${module.name} loading error: ${e.message}`, false);
                }
            });
        }

        function testClassInstantiation() {
            try {
                const app = new MivtzahPlatform();
                addResult('instantiation-results', 'MivtzahPlatform instantiated successfully');
                
                if (app.core && app.messaging && app.student && app.admin) {
                    addResult('instantiation-results', 'All module instances created successfully');
                } else {
                    addResult('instantiation-results', 'Some module instances missing', false);
                }
            } catch (e) {
                addResult('instantiation-results', `Instantiation error: ${e.message}`, false);
            }
        }

        function testCoreFunctionality() {
            try {
                const app = new MivtzahPlatform();
                
                // Test core utilities
                const today = app.core.getCurrentDate();
                if (today) {
                    addResult('functionality-results', 'Date utilities working');
                }

                // Test data management
                const testData = { test: 'data' };
                app.core.saveToStorage('test_key', testData);
                const retrieved = app.core.getFromStorage('test_key');
                if (retrieved && retrieved.test === 'data') {
                    addResult('functionality-results', 'Data storage/retrieval working');
                } else {
                    addResult('functionality-results', 'Data storage/retrieval failed', false);
                }

                // Test authentication structure
                if (typeof app.core.isUserLoggedIn === 'function') {
                    addResult('functionality-results', 'Authentication methods available');
                }

            } catch (e) {
                addResult('functionality-results', `Functionality test error: ${e.message}`, false);
            }
        }

        function testDataPersistence() {
            try {
                const app = new MivtzahPlatform();
                
                // Test localStorage keys
                const expectedKeys = [
                    'mivtzah_students',
                    'mivtzah_admins',
                    'mivtzah_submissions',
                    'mivtzah_weeklySchedule',
                    'mivtzah_eventThresholds',
                    'mivtzah_chineseAuction',
                    'mivtzah_adminRequests'
                ];

                let keysFound = 0;
                expectedKeys.forEach(key => {
                    if (localStorage.getItem(key) !== null) {
                        keysFound++;
                    }
                });

                if (keysFound > 0) {
                    addResult('persistence-results', `Found ${keysFound}/${expectedKeys.length} expected localStorage keys`);
                } else {
                    addResult('persistence-results', 'No existing data found (this is normal for first run)');
                }                // Test data initialization (already happens in constructor)
                // app.core.initializeData() is called automatically
                addResult('persistence-results', 'Data initialization completed automatically');

            } catch (e) {
                addResult('persistence-results', `Persistence test error: ${e.message}`, false);
            }
        }

        // Run all tests
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                testModuleLoading();
                testClassInstantiation();
                testCoreFunctionality();
                testDataPersistence();
            }, 100);
        });
    </script>
</body>
</html>
